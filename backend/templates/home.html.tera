<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Login</title>  
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  	<link href="/assets/style.css" rel="stylesheet">
	<script>
		let socket;
		function setupWebSocket(protocol) {
			socket = new WebSocket(protocol + '://' + window.location.host + '/api/chat');

			socket.onclose = function (event) {
				if (event.code === 1015 && protocol === 'wss') {
					console.log("failed to connect using wss; falling back to ws");
					setupWebSocket("ws");
					return;
				}
				// ... (other close event handling code remains unchanged)
			};

			socket.onopen = function (event) {
				console.log('Opened Websocket');
				// You can send messages here if needed
			};

			socket.onmessage = function (event) {
				console.log('Message received: ' + event.data);
				// Handle incoming messages here
			};

			socket.onerror = function (error) {
				console.error('WebSocket error: ' + error.message);
				// Handle any errors here
			};
		}

		function sendMessage(inputValue) {
			console.log("sending to server : " + inputValue);

			if (socket && socket.readyState === WebSocket.OPEN) {
				socket.send(JSON.stringify(inputValue));
			} else {
				console.error("WebSocket connection is not open");
			}
		}

		function initialize(sendButton, inputField) {
			// Remove existing event listeners to prevent duplicates
			sendButton.removeEventListener('click', sendButtonClickHandler);
			inputField.removeEventListener('keypress', inputFieldKeyPressHandler);

			// Add event listeners
			sendButton.addEventListener('click', sendButtonClickHandler);
			inputField.addEventListener('keypress', inputFieldKeyPressHandler);

			function sendButtonClickHandler() {
				console.log("send button pressed");
				sendMessage(inputField.value);
			}

			function inputFieldKeyPressHandler(event) {
				if (event.key === "Enter") {
					console.log("enter key pressed");
					sendMessage(inputField.value);
				}
			}
		}
		function openSocket() {
			setupWebSocket('wss');
		}

		document.addEventListener('DOMContentLoaded', function() {
			const inputField = document.getElementById('inputField');
			const sendButton = document.getElementById('enterButton');

			openSocket();
			initialize(sendButton, inputField);
		});
	</script>
</head>
<body>
    <div class="fixed flex inset-0 justify-center bg-black z-[-1] bg-cover bg-center" style="background-image: url(public/background.jpg)">
        <!-- <div class="bg-gradient-to-b from-slate-700 via-gray-900 to-slate-900 absolute inset-0"></div> -->
	</div>

	<div class="m-10 text-white text-xs sm:text-base font-mono bg-opacity-20 shadow-2xl shadow-black/50 backdrop-blur-sm bg-black flex flex-col gap-5 p-5 sm:p-10 rounded-2xl m-auto">
		{% for message in messages %}
			{% include "message" %}
		{% endfor %}
		<div class="flex flex-row gap-2">
			<input class="grow hover:font-bold bg-opacity-30 shadow-lg shadow-black/50 backdrop-blur-sm bg-black p-4 hover:ring-4 ring-slate-400 rounded-md" type="text" id="inputField"  placeholder="Enter a message"/>
			<button class="hover:font-bold bg-opacity-30 shadow-lg shadow-black/50 backdrop-blur-sm bg-black p-4 hover:ring-4 ring-slate-400 rounded-md" type="submit" id="enterButton">‚èé</button>
		</div>
	</div>
</body>
</html>










