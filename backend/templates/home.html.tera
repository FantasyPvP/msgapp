<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Login</title>  
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  	<link href="/assets/style.css" rel="stylesheet">
	<script>
		var socket = new WebSocket('ws://' + window.location.host + '/api/chat');
        socket.onopen = function(event) {
            console.log('WebSocket is open now.');
            // You can send messages here if needed
        };
        socket.onmessage = function(event) {
            console.log('Message received: ' + event.data);
            // Handle incoming messages here
        };
        socket.onclose = function(event) {
            if (event.wasClean) {
                console.log('WebSocket closed cleanly');
            } else {
                console.error('WebSocket connection closed unexpectedly');
            }
            console.log('Code: ' + event.code + ' Reason: ' + event.reason);
        };
        socket.onerror = function(error) {
            console.error('WebSocket error: ' + error.message);
            // Handle any errors here
        };
	
		function insertMessage(message) {
 			// Assuming there's a <div> with id "messageContainer" to hold the messages
	   		const messageContainer = document.getElementById('messageContainer');
 	   		const messageElement = document.createElement('div');
			messageElement.textContent = message.content; // Assuming the message object has a "content" property
 	   		messageContainer.appendChild(messageElement);
		};
		function handleKeyPress(event) {
      		if (event.key === "Enter") {
    		    sendMessage()
       		};
		};
        function sendMessage() {
            const inputValue = document.getElementById('inputField').value;
			console.log("sending to server : " + inputValue);
				
    		if (socket && socket.readyState === WebSocket.OPEN) {
      			socket.send(JSON.stringify(inputValue));
			} else {
                console.error("WebSocket connection is not open");	
			}
        };
	</script>
</head>
<body>
    <div class="fixed flex inset-0 justify-center bg-black z-[-1] class="bg-cover bg-center" style="background-image: url(public/background.jpg)">
        <!-- <div class="bg-gradient-to-b from-slate-700 via-gray-900 to-slate-900 absolute inset-0"></div> -->
	</div>
        <div class="m-10 text-white text-xs sm:text-base font-mono bg-opacity-20 shadow-2xl shadow-black/50 backdrop-blur-sm bg-black flex flex-col gap-5 p-5 sm:p-10 rounded-2xl m-auto">
			{% for message in messages %}
				{% include "message" %}
			{% endfor %}
            <div class="flex flex-row gap-2">
                <input class="grow hover:font-bold bg-opacity-30 shadow-lg shadow-black/50 backdrop-blur-sm bg-black p-4 hover:ring-4 ring-slate-400 rounded-md" type="text" id="inputField" onkeydown="handleKeyPress(event)" placeholder="Enter a message"/>
		        <button class="hover:font-bold bg-opacity-30 shadow-lg shadow-black/50 backdrop-blur-sm bg-black p-4 hover:ring-4 ring-slate-400 rounded-md" type="submit" onclick="sendMessage()">‚èé</button>
            </div>
        </div>
	</div>
</body>
</html>
